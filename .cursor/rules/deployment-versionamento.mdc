---
description: 
globs: 
alwaysApply: true
---
# Deployment e Versionamento

## üìã Versionamento Sem√¢ntico

### Padr√£o Atual (v0.4.0)
- **MAJOR** (1.x.x): Mudan√ßas que quebram compatibilidade
- **MINOR** (0.x.x): Novas funcionalidades compat√≠veis (pr√©-release)
- **PATCH** (x.x.x): Corre√ß√µes de bugs e melhorias

### Pr√≥ximas Vers√µes Planejadas
- **v0.1.0**: ‚úÖ Fase 1.1 - Pol√≠tica de Reten√ß√£o de Backups (Conclu√≠do)
- **v0.2.0**: ‚úÖ Fase 1.2 - Painel de Hist√≥rico (SQLite + Interface) (Conclu√≠do)
- **v0.3.0**: ‚úÖ Fase 1.3 - Logs em Tempo Real (WebSocket) (Conclu√≠do)
- **v0.3.1**: ‚úÖ Fase 1.4 - Sistema Auto-Update (GitHub) (Conclu√≠do)
- **v0.4.0**: ‚úÖ Fase 2.1 - Notifica√ß√µes por E-mail (SMTP) (Conclu√≠do)
- **v0.5.0**: Fase 2.2 - Integra√ß√£o Telegram/WhatsApp
- **v1.0.0**: Release est√°vel com todas funcionalidades base
- **v1.1.0**: Fase 3 - Backup arquivos + MySQL/PostgreSQL
- **v2.0.0**: Expans√£o completa (S3, Google Drive, Restaura√ß√£o)

## üöÄ Processo de Build

### Scripts de Build ([package.json](mdc:package.json))
```json
{
  "scripts": {
    "start": "node src/app.js",
    "build": "node scripts/build.js", 
    "build:installer": "powershell -ExecutionPolicy Bypass -File scripts/build-installer.ps1"
  }
}
```

### Build Process ([scripts/build.js](mdc:scripts/build.js))
1. **Embarca Assets**: 7za.exe, nssm.exe, public/*
2. **Gera embedded-assets.js**: Base64 dos arquivos embarcados
3. **Executa pkg**: Compila√ß√£o para Windows x64 Node 12
4. **Cleanup**: Remove arquivos tempor√°rios
5. **Output**: NodeBackup.exe (¬±85MB)

### Assets Embarcados Obrigat√≥rios
- **7za.exe** (723KB) - 7-Zip console para compress√£o
- **nssm.exe** (288KB) - Non-Sucking Service Manager
- **public/** - Interface web modular completa (‚âà73KB)
  - **CSS Modular**: 5 arquivos especializados (25KB)
  - **JavaScript Modular**: 10 m√≥dulos espec√≠ficos (48KB)

## üì¶ Estrutura de Release

### Arquivos de Distribui√ß√£o
```
Release/
‚îú‚îÄ‚îÄ NodeBackup.exe          # Execut√°vel principal
‚îú‚îÄ‚îÄ README.txt              # Instru√ß√µes b√°sicas
‚îú‚îÄ‚îÄ LICENSE.txt             # Licen√ßa MIT
‚îî‚îÄ‚îÄ CHANGELOG.md            # Hist√≥rico de vers√µes
```

### GitHub Releases
- **Tag**: v0.4.0 (seguir semver exato)
- **Title**: "NodeBackup v0.4.0 - Notifica√ß√µes por E-mail"
- **Description**: Changelog detalhado + instru√ß√µes
- **Assets**: NodeBackupInstaller.exe (recomendado)

## üîÑ Pipeline de Deploy

### Workflow GitHub Actions (`.github/workflows/release.yml`)
```yaml
# Triggers:
# - Push em tags v*.*.*
# - Release manual via GitHub

# Steps:
# 1. Checkout c√≥digo
# 2. Setup Node.js 12.x
# 3. npm install
# 4. npm run build
# 5. Upload assets para release
```

### Valida√ß√µes Pr√©-Release
- [ ] **Build Success**: NodeBackup.exe gerado sem erros
- [ ] **Teste Funcional**: Execu√ß√£o b√°sica funcionando
- [ ] **Compatibilidade**: Testado em Windows 7, 10, 11
- [ ] **Tamanho**: Execut√°vel < 100MB
- [ ] **Assets**: 7za.exe e nssm.exe inclu√≠dos e funcionais

## üìù Padr√µes de Commit

### Conventional Commits (Com Emojis)
- **feat**: ‚ú® Novas funcionalidades
- **fix**: üêõ Corre√ß√µes de bugs
- **refactor**: ‚ôªÔ∏è Refatora√ß√£o sem mudan√ßa funcional
- **chore**: üîß Mudan√ßas de configura√ß√£o/build
- **docs**: üìù Atualiza√ß√µes de documenta√ß√£o
- **style**: üíÑ Mudan√ßas de formata√ß√£o/estilo
- **test**: ‚úÖ Adi√ß√£o ou corre√ß√£o de testes
- **perf**: ‚ö° Melhorias de performance
- **ci**: üë∑ Mudan√ßas de CI/CD
- **build**: üì¶ Mudan√ßas no sistema de build
- **revert**: ‚è™ Revers√£o de commits

### Exemplos
```bash
feat: ‚ú® adicionar pol√≠tica de reten√ß√£o para backups antigos
fix: üêõ corrigir erro de conex√£o FTP com SSL
refactor: ‚ôªÔ∏è reorganizar estrutura de servi√ßos
chore: üîß atualizar depend√™ncias para Node 12 LTS
docs: üìù atualizar README com novas funcionalidades v0.1.0
```

## üåç Instalador Completo (Opcional)

### NSIS Installer ([installer.nsi](mdc:installer.nsi))
- **Setup Wizard**: Instala√ß√£o guiada Windows
- **Service Installation**: Instala automaticamente como servi√ßo
- **Uninstaller**: Remo√ß√£o completa + limpeza registry
- **Target**: Windows 7+ (x64)

### Build Installer ([scripts/build-installer.ps1](mdc:scripts/build-installer.ps1))
```powershell
# 1. Verifica se NodeBackup.exe existe
# 2. Compila installer.nsi com NSIS
# 3. Gera NodeBackupInstaller.exe
# 4. Valida√ß√£o b√°sica do instalador
```

## üìä M√©tricas de Qualidade

### M√©tricas de Build
- **Build Time**: < 2 minutos
- **Executable Size**: ~85MB (aumento devido √† modularidade)
- **Memory Usage**: < 200MB em runtime
- **Startup Time**: < 5 segundos

### Compatibilidade Testada
- **Windows 7** SP1 x64
- **Windows 10** (todas as vers√µes)
- **Windows 11** 
- **Windows Server 2012+**

### SQL Server Compatibilidade
- **SQL Server 2008** R2+
- **SQL Server 2012/2014/2016/2017/2019/2022**
- **SQL Express** (todas as vers√µes)

## üîç Checklist de Release

### ‚úÖ Pr√©-Release
- [ ] **Vers√£o atualizada** no package.json
- [ ] **CHANGELOG.md** atualizado com mudan√ßas
- [ ] **README.md** atualizado se necess√°rio
- [ ] **Testes locais** executados com sucesso
- [ ] **Build local** funcional
- [ ] **Instala√ß√£o como servi√ßo** testada

### ‚úÖ Durante Release
- [ ] **Tag git** criado (git tag v1.x.x)
- [ ] **GitHub Release** criado
- [ ] **Assets** anexados (exe + installer)
- [ ] **Descri√ß√£o** detalhada das mudan√ßas
- [ ] **Instru√ß√µes** de upgrade se necess√°rio

### ‚úÖ P√≥s-Release
- [ ] **Valida√ß√£o** do download p√∫blico
- [ ] **Teste** do execut√°vel baixado
- [ ] **Documenta√ß√£o** atualizada se necess√°rio
- [ ] **Issues** relacionadas fechadas
- [ ] **Pr√≥xima milestone** planejada

## üîß Troubleshooting Build

### Problemas Comuns

#### üö´ "pkg target node12-win-x64 n√£o encontrado"
```bash
# Solu√ß√£o: Instalar pkg globalmente
npm install -g pkg@5.8.1
```

#### üö´ "Assets n√£o embarcados"
```bash
# Verificar se arquivos existem:
# - 7za.exe (root)
# - nssm.exe (root)  
# - public/* (pasta public)
```

#### üö´ "Execut√°vel muito grande (>100MB)"
```bash
# Verificar se embedded-assets.js n√£o foi commitado
# Deve ser gerado apenas durante build
rm src/embedded-assets.js
```

#### üö´ "Falha ao executar como servi√ßo"
```bash
# Verificar se nssm.exe est√° embarcado
# Testar instala√ß√£o manual:
.\NodeBackup.exe --install
```

## üìà Roadmap de Deploy

### M√©tricas e Monitoramento
- [ ] **Telemetria an√¥nima** de uso (opt-in)
- [ ] **Update checker** autom√°tico

### Distribui√ß√£o
- [ ] **Auto-updater** interno





