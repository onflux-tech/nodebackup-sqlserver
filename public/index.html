<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NodeBackup - Configuração de Backup SQL Server</title>
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/base.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/components.css">
  <link rel="stylesheet" href="css/responsive.css">
  <script src="https://unpkg.com/lucide@latest"></script>
</head>

<body>
  <!-- Toast Container -->
  <div id="toast-container" class="toast-container"></div>

  <!-- Mobile Menu Overlay -->
  <div id="mobile-overlay" class="mobile-overlay"></div>

  <!-- Main App Container -->
  <div class="app-container">

    <!-- Header -->
    <header class="app-header">
      <div class="header-left">
        <button id="mobile-menu-toggle" class="mobile-menu-btn" aria-label="Abrir menu">
          <i data-lucide="menu"></i>
        </button>
        <div class="app-logo">
          <div class="logo-icon">
            <i data-lucide="database"></i>
          </div>
          <div class="logo-text">
            <h1>NodeBackup</h1>
            <span>Database Backup Manager</span>
          </div>
        </div>
      </div>

      <div class="header-actions">
        <button id="themeToggle" class="action-btn" title="Alternar tema">
          <i data-lucide="sun" class="theme-icon-light"></i>
          <i data-lucide="moon" class="theme-icon-dark"></i>
        </button>

        <button type="submit" id="saveButton" class="action-btn primary" title="Salvar Configurações" form="configForm">
          <i data-lucide="save"></i>
          <span class="action-text">Salvar</span>
          <div class="spinner"></div>
        </button>

        <button type="button" id="logoutButton" class="action-btn danger" title="Sair">
          <i data-lucide="log-out"></i>
        </button>
      </div>
    </header>

    <!-- Main Layout -->
    <div class="app-layout">

      <!-- Sidebar Navigation -->
      <nav id="sidebar" class="sidebar">
        <div class="sidebar-content">
          <div class="nav-section">
            <h3 class="nav-section-title">Configuração</h3>
            <div class="nav-items">
              <button class="nav-item active" data-tab="database">
                <div class="nav-item-icon">
                  <i data-lucide="database"></i>
                </div>
                <div class="nav-item-content">
                  <span class="nav-item-title">Banco de Dados</span>
                  <span class="nav-item-subtitle">SQL Server</span>
                </div>
              </button>

              <button class="nav-item" data-tab="storage">
                <div class="nav-item-icon">
                  <i data-lucide="hard-drive"></i>
                </div>
                <div class="nav-item-content">
                  <span class="nav-item-title">Armazenamento</span>
                  <span class="nav-item-subtitle">FTP & Local</span>
                </div>
              </button>

              <button class="nav-item" data-tab="schedule">
                <div class="nav-item-icon">
                  <i data-lucide="clock"></i>
                </div>
                <div class="nav-item-content">
                  <span class="nav-item-title">Agendamento</span>
                  <span class="nav-item-subtitle">Horários</span>
                </div>
              </button>

              <button class="nav-item" data-tab="retention">
                <div class="nav-item-icon">
                  <i data-lucide="trash-2"></i>
                </div>
                <div class="nav-item-content">
                  <span class="nav-item-title">Retenção</span>
                  <span class="nav-item-subtitle">Limpeza</span>
                </div>
              </button>

              <button class="nav-item" data-tab="history">
                <div class="nav-item-icon">
                  <i data-lucide="activity"></i>
                </div>
                <div class="nav-item-content">
                  <span class="nav-item-title">Histórico</span>
                  <span class="nav-item-subtitle">Estatísticas e Execuções</span>
                </div>
              </button>
            </div>
          </div>
        </div>
      </nav>

      <!-- Main Content -->
      <main class="main-content">
        <form id="configForm" autocomplete="off" class="config-form">

          <!-- Database Tab -->
          <div class="tab-content active" id="tab-database">
            <div class="page-header">
              <div class="page-header-content">
                <div class="page-icon">
                  <i data-lucide="database"></i>
                </div>
                <div class="page-info">
                  <h2 class="page-title">Configuração do Banco de Dados</h2>
                  <p class="page-description">Configure a conexão com o SQL Server e selecione os bancos para backup</p>
                </div>
              </div>
            </div>

            <div class="content-grid">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">
                    <i data-lucide="server"></i>
                    Conexão SQL Server
                  </h3>
                </div>
                <div class="card-content">
                  <div class="form-grid">
                    <div class="form-group col-span-2">
                      <label for="dbServer">Servidor SQL</label>
                      <div class="input-wrapper">
                        <i data-lucide="server" class="input-icon"></i>
                        <input type="text" id="dbServer" placeholder="localhost\SQLEXPRESS" autocomplete="off">
                      </div>
                      <p class="form-help">Ex: localhost ou NOME_PC\SQLEXPRESS</p>
                    </div>

                    <div class="form-group">
                      <label for="dbUser">Usuário</label>
                      <div class="input-wrapper">
                        <i data-lucide="user" class="input-icon"></i>
                        <input type="text" id="dbUser" placeholder="sa" autocomplete="off">
                      </div>
                    </div>

                    <div class="form-group">
                      <label for="dbPass">Senha</label>
                      <div class="input-wrapper">
                        <i data-lucide="lock" class="input-icon"></i>
                        <input type="password" id="dbPass" placeholder="••••••••" autocomplete="new-password">
                      </div>
                    </div>
                  </div>

                  <div class="button-group">
                    <button type="button" id="btnListDatabases" class="btn btn-primary">
                      <i data-lucide="refresh-cw"></i>
                      <span class="btn-text">Listar Bancos</span>
                      <div class="spinner"></div>
                    </button>
                  </div>
                </div>
              </div>

              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">
                    <i data-lucide="check-square"></i>
                    Bancos Selecionados
                  </h3>
                </div>
                <div class="card-content">
                  <div class="form-group">
                    <div id="selectedDatabasesTags" class="selected-databases-tags">
                      <div class="empty-selection">
                        <i data-lucide="database"></i>
                        <span>Nenhum banco selecionado</span>
                        <p>Clique em "Listar Bancos" para selecionar</p>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Storage Tab -->
          <div class="tab-content" id="tab-storage">
            <div class="page-header">
              <div class="page-header-content">
                <div class="page-icon">
                  <i data-lucide="hard-drive"></i>
                </div>
                <div class="page-info">
                  <h2 class="page-title">Armazenamento</h2>
                  <p class="page-description">Configure destinos para salvar os backups</p>
                </div>
              </div>
            </div>

            <div class="content-grid">
              <!-- FTP Storage -->
              <div class="storage-card">
                <div class="card-header">
                  <div class="storage-toggle">
                    <input type="checkbox" id="ftpEnabled" class="toggle-switch">
                    <label for="ftpEnabled" class="toggle-label">
                      <span class="toggle-slider"></span>
                    </label>
                  </div>
                  <div class="storage-info">
                    <h3 class="card-title">
                      <i data-lucide="cloud-upload"></i>
                      Servidor FTP
                    </h3>
                    <p class="card-description">Upload automático para servidor FTP</p>
                  </div>
                </div>

                <div id="ftpForm" class="storage-form">
                  <div class="form-grid">
                    <div class="form-group">
                      <label for="ftpHost">Host</label>
                      <div class="input-wrapper">
                        <i data-lucide="globe" class="input-icon"></i>
                        <input type="text" id="ftpHost" placeholder="ftp.exemplo.com" autocomplete="off">
                      </div>
                    </div>

                    <div class="form-group">
                      <label for="ftpPort">Porta</label>
                      <div class="input-wrapper">
                        <i data-lucide="hash" class="input-icon"></i>
                        <input type="number" id="ftpPort" placeholder="21" value="21">
                      </div>
                    </div>

                    <div class="form-group">
                      <label for="ftpUser">Usuário</label>
                      <div class="input-wrapper">
                        <i data-lucide="user" class="input-icon"></i>
                        <input type="text" id="ftpUser" placeholder="usuario_ftp" autocomplete="off">
                      </div>
                    </div>

                    <div class="form-group">
                      <label for="ftpPass">Senha</label>
                      <div class="input-wrapper">
                        <i data-lucide="lock" class="input-icon"></i>
                        <input type="password" id="ftpPass" placeholder="••••••••" autocomplete="new-password">
                      </div>
                    </div>

                    <div class="form-group col-span-2">
                      <label for="ftpRemoteDir">Diretório</label>
                      <div class="input-wrapper">
                        <i data-lucide="folder" class="input-icon"></i>
                        <input type="text" id="ftpRemoteDir" placeholder="/backups/">
                      </div>
                    </div>
                  </div>

                  <button type="button" id="btnTestFtp" class="btn btn-outline">
                    <i data-lucide="wifi"></i>
                    <span class="btn-text">Testar Conexão</span>
                    <div class="spinner"></div>
                  </button>
                </div>
              </div>

              <!-- Network Path Storage -->
              <div class="storage-card">
                <div class="card-header">
                  <div class="storage-toggle">
                    <input type="checkbox" id="networkPathEnabled" class="toggle-switch">
                    <label for="networkPathEnabled" class="toggle-label">
                      <span class="toggle-slider"></span>
                    </label>
                  </div>
                  <div class="storage-info">
                    <h3 class="card-title">
                      <i data-lucide="folder-open"></i>
                      Local/Rede
                    </h3>
                    <p class="card-description">Cópia para pasta local ou de rede</p>
                  </div>
                </div>

                <div id="networkPathForm" class="storage-form">
                  <div class="form-group">
                    <label for="networkPath">Caminho</label>
                    <div class="input-group">
                      <div class="input-wrapper">
                        <i data-lucide="folder" class="input-icon"></i>
                        <input type="text" id="networkPath" placeholder="\\servidor\share\backups">
                      </div>
                      <button type="button" id="browsePathBtn" class="btn btn-outline">
                        <i data-lucide="search"></i>
                        Procurar
                      </button>
                    </div>
                    <p class="form-help">Caminho local (D:\backups) ou UNC (\\servidor\share)</p>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Schedule Tab -->
          <div class="tab-content" id="tab-schedule">
            <div class="page-header">
              <div class="page-header-content">
                <div class="page-icon">
                  <i data-lucide="clock"></i>
                </div>
                <div class="page-info">
                  <h2 class="page-title">Agendamento</h2>
                  <p class="page-description">Configure quando os backups devem ser executados</p>
                </div>
              </div>
            </div>

            <div class="content-grid single-column">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">
                    <i data-lucide="tag"></i>
                    Identificação
                  </h3>
                </div>
                <div class="card-content">
                  <div class="form-group">
                    <label for="clientName">Nome do Cliente</label>
                    <div class="input-wrapper">
                      <i data-lucide="landmark" class="input-icon"></i>
                      <input type="text" id="clientName" placeholder="Nome do Cliente">
                    </div>
                    <p class="form-help">Este nome será usado nos arquivos de backup</p>
                  </div>
                </div>
              </div>

              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">
                    <i data-lucide="alarm-clock"></i>
                    Horários de Execução
                  </h3>
                  <button type="button" id="addSchedule" class="btn btn-outline btn-sm">
                    <i data-lucide="plus"></i>
                    Adicionar
                  </button>
                </div>
                <div class="card-content">
                  <div id="scheduleInputs" class="schedule-list"></div>
                  <p class="form-help">Defina um ou mais horários no formato HH:MM para execução automática</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Retention Tab -->
          <div class="tab-content" id="tab-retention">
            <div class="page-header">
              <div class="page-header-content">
                <div class="page-icon">
                  <i data-lucide="trash-2"></i>
                </div>
                <div class="page-info">
                  <h2 class="page-title">Política de Retenção</h2>
                  <p class="page-description">Configure a limpeza automática de backups antigos</p>
                </div>
              </div>
            </div>

            <div class="content-grid">
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">
                    <i data-lucide="settings"></i>
                    Configurações Gerais
                  </h3>
                </div>
                <div class="card-content">
                  <div class="form-group">
                    <div class="toggle-group">
                      <input type="checkbox" id="retentionEnabled" class="toggle-switch" checked>
                      <label for="retentionEnabled" class="toggle-label">
                        <span class="toggle-slider"></span>
                        <span class="toggle-text">Ativar limpeza automática</span>
                      </label>
                    </div>
                  </div>

                  <div class="form-group">
                    <label>Modo de Operação</label>
                    <div class="radio-group">
                      <div class="radio-item">
                        <input type="radio" id="modeClassic" name="retentionMode" value="classic">
                        <label for="modeClassic" class="radio-label">
                          <div class="radio-icon">
                            <i data-lucide="repeat"></i>
                          </div>
                          <div class="radio-content">
                            <span class="radio-title">Modo Clássico</span>
                            <span class="radio-description">Mantém apenas 1 backup por horário</span>
                          </div>
                        </label>
                      </div>

                      <div class="radio-item">
                        <input type="radio" id="modeRetention" name="retentionMode" value="retention" checked>
                        <label for="modeRetention" class="radio-label">
                          <div class="radio-icon">
                            <i data-lucide="calendar"></i>
                          </div>
                          <div class="radio-content">
                            <span class="radio-title">Modo Retenção</span>
                            <span class="radio-description">Acumula backups com timestamp</span>
                          </div>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">
                    <i data-lucide="calendar-days"></i>
                    Período de Retenção
                  </h3>
                </div>
                <div class="card-content">
                  <div class="form-grid">
                    <div class="form-group">
                      <label for="localRetentionDays">Local (dias)</label>
                      <div class="input-wrapper">
                        <i data-lucide="calendar-plus" class="input-icon"></i>
                        <input type="number" id="localRetentionDays" min="1" max="365" value="7">
                      </div>
                    </div>

                    <div class="form-group">
                      <label for="ftpRetentionDays">FTP (dias)</label>
                      <div class="input-wrapper">
                        <i data-lucide="calendar-plus" class="input-icon"></i>
                        <input type="number" id="ftpRetentionDays" min="1" max="365" value="30">
                      </div>
                    </div>
                  </div>

                  <div class="form-group">
                    <div class="toggle-group">
                      <input type="checkbox" id="autoCleanup" class="toggle-switch" checked>
                      <label for="autoCleanup" class="toggle-label">
                        <span class="toggle-slider"></span>
                        <span class="toggle-text">Limpeza automática após backup</span>
                      </label>
                    </div>
                  </div>
                </div>
              </div>

              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">
                    <i data-lucide="play"></i>
                    Limpeza Manual
                  </h3>
                </div>
                <div class="card-content">
                  <div class="cleanup-buttons">
                    <button type="button" id="btnCleanupLocal" class="btn btn-outline">
                      <i data-lucide="brush-cleaning"></i>
                      <span class="btn-text">Limpar Local</span>
                      <div class="spinner"></div>
                    </button>
                    <button type="button" id="btnCleanupFtp" class="btn btn-outline">
                      <i data-lucide="brush-cleaning"></i>
                      <span class="btn-text">Limpar FTP</span>
                      <div class="spinner"></div>
                    </button>
                  </div>
                  <p class="form-help">Execute limpeza manual conforme a política configurada</p>
                </div>
              </div>
            </div>
          </div>

          <!-- History Tab -->
          <div class="tab-content" id="tab-history">
            <div class="page-header">
              <div class="page-header-content">
                <div class="page-icon">
                  <i data-lucide="activity"></i>
                </div>
                <div class="page-info">
                  <h2 class="page-title">Histórico de Backups</h2>
                  <p class="page-description">Visualize execuções, estatísticas e detalhes</p>
                </div>
              </div>
            </div>

            <div class="content-grid single-column">
              <!-- Stats Cards -->
              <div class="stats-grid">
                <div class="stat-card">
                  <div class="stat-icon">
                    <i data-lucide="database"></i>
                  </div>
                  <div class="stat-content">
                    <span class="stat-value" id="stats-total">0</span>
                    <span class="stat-label">Total</span>
                  </div>
                </div>

                <div class="stat-card success">
                  <div class="stat-icon">
                    <i data-lucide="check-circle"></i>
                  </div>
                  <div class="stat-content">
                    <span class="stat-value" id="stats-success">0</span>
                    <span class="stat-label">Sucessos</span>
                  </div>
                </div>

                <div class="stat-card error">
                  <div class="stat-icon">
                    <i data-lucide="x-circle"></i>
                  </div>
                  <div class="stat-content">
                    <span class="stat-value" id="stats-failed">0</span>
                    <span class="stat-label">Falhas</span>
                  </div>
                </div>

                <div class="stat-card">
                  <div class="stat-icon">
                    <i data-lucide="clock"></i>
                  </div>
                  <div class="stat-content">
                    <span class="stat-value" id="stats-avg-duration">0s</span>
                    <span class="stat-label">Duração Média</span>
                  </div>
                </div>

                <div class="stat-card">
                  <div class="stat-icon">
                    <i data-lucide="hard-drive"></i>
                  </div>
                  <div class="stat-content">
                    <span class="stat-value" id="stats-total-size">0 MB</span>
                    <span class="stat-label">Tamanho Total</span>
                  </div>
                </div>
              </div>

              <!-- History Table Card -->
              <div class="card">
                <div class="card-header">
                  <h3 class="card-title">
                    <i data-lucide="list"></i>
                    Registro de Execuções
                  </h3>
                  <div class="card-actions">
                    <div class="filter-group">
                      <label for="status-filter">Status:</label>
                      <select id="status-filter" class="filter-select">
                        <option value="">Todos</option>
                        <option value="success">Sucesso</option>
                        <option value="failed">Falha</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="table-container">
                  <table id="history-table" class="data-table">
                    <thead>
                      <tr>
                        <th>Data/Hora</th>
                        <th>Bancos</th>
                        <th>Status</th>
                        <th>Duração</th>
                        <th>Tamanho</th>
                        <th>Detalhes</th>
                      </tr>
                    </thead>
                    <tbody>
                      <!-- Populated by JavaScript -->
                    </tbody>
                  </table>
                </div>

                <div class="table-footer">
                  <div class="pagination">
                    <button type="button" id="prev-page" class="pagination-btn" disabled>
                      <i data-lucide="chevron-left"></i>
                      Anterior
                    </button>
                    <span id="page-info" class="pagination-info">Página 1 de 1</span>
                    <button type="button" id="next-page" class="pagination-btn" disabled>
                      Próximo
                      <i data-lucide="chevron-right"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

        </form>
      </main>
    </div>
  </div>

  <!-- Modals -->
  <div id="folderBrowserModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <i data-lucide="folder-open"></i>
          Selecionar Pasta
        </h3>
        <button type="button" class="modal-close" id="closeFolderBrowser">
          <i data-lucide="x"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="folder-browser">
          <div class="browser-toolbar">
            <button type="button" id="levelUpBtn" class="btn btn-outline btn-sm">
              <i data-lucide="arrow-up"></i>
              Voltar
            </button>
            <button type="button" id="homeDrivesBtn" class="btn btn-outline btn-sm">
              <i data-lucide="hard-drive"></i>
              Drives
            </button>
            <div class="path-input">
              <input type="text" id="currentPathInput" placeholder="Digite um caminho...">
            </div>
          </div>

          <div id="folderList" class="folder-list">
            <!-- Populated by JavaScript -->
          </div>
          <p class="form-help">💡 Clique em uma pasta ou drive para navegar</p>
        </div>
      </div>

      <div class="modal-footer">
        <div class="new-folder">
          <input type="text" id="newFolderNameInput" placeholder="Nome da nova pasta">
          <button type="button" id="createNewFolderBtn" class="btn btn-outline">
            <i data-lucide="folder-plus"></i>
            Criar
          </button>
        </div>
        <button type="button" id="selectFolderBtn" class="btn btn-primary">
          <i data-lucide="check"></i>
          Selecionar
        </button>
      </div>
    </div>
  </div>

  <div id="backupDetailsModal" class="modal">
    <div class="modal-content modal-large">
      <div class="modal-header">
        <h3 class="modal-title" id="backupDetailsTitle">
          <i data-lucide="info"></i>
          Detalhes do Backup
        </h3>
        <button type="button" class="modal-close" id="closeBackupDetailsModal">
          <i data-lucide="x"></i>
        </button>
      </div>
      <div class="modal-body">
        <div id="backupDetailsContent" class="backup-details-content">
          <!-- Conteúdo será populado dinamicamente -->
        </div>
      </div>
    </div>
  </div>

  <div id="databaseSelectorModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">
          <i data-lucide="database"></i>
          Selecionar Bancos de Dados
        </h3>
        <button type="button" class="modal-close" id="closeDatabaseSelector">
          <i data-lucide="x"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="database-selector">
          <div class="database-toolbar">
            <div class="selection-info">
              <span id="selectionCount">0 bancos selecionados</span>
            </div>
            <div class="selection-actions">
              <button type="button" id="selectAllDbs" class="btn btn-outline btn-sm">
                <i data-lucide="check-square"></i>
                Selecionar Todos
              </button>
              <button type="button" id="clearAllDbs" class="btn btn-outline btn-sm">
                <i data-lucide="square"></i>
                Limpar Seleção
              </button>
            </div>
          </div>

          <div id="databaseList" class="database-list">
            <div class="loading-databases">
              <div class="spinner" style="display: block; margin: 2rem auto;"></div>
              <p>Carregando bancos de dados...</p>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" id="cancelDatabaseSelection" class="btn btn-outline">
          <i data-lucide="x"></i>
          Cancelar
        </button>
        <button type="button" id="confirmDatabaseSelection" class="btn btn-primary">
          <i data-lucide="check"></i>
          Confirmar Seleção
        </button>
      </div>
    </div>
  </div>

  <script src="script.js" type="module"></script>
  <script>
    lucide.createIcons();
  </script>
</body>

</html>